<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="[Blog] Stack Pivot - Overflow in libc function" /><meta property="og:locale" content="en" /><meta name="description" content="Stack pivot technique" /><meta property="og:description" content="Stack pivot technique" /><link rel="canonical" href="https://blog.kaytii.me/posts/stack-pivot-technique/" /><meta property="og:url" content="https://blog.kaytii.me/posts/stack-pivot-technique/" /><meta property="og:site_name" content="KayTii" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-12-09T07:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Blog] Stack Pivot - Overflow in libc function" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-12-09T22:52:30+07:00","datePublished":"2025-12-09T07:00:00+07:00","description":"Stack pivot technique","headline":"[Blog] Stack Pivot - Overflow in libc function","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kaytii.me/posts/stack-pivot-technique/"},"url":"https://blog.kaytii.me/posts/stack-pivot-technique/"}</script><title>[Blog] Stack Pivot - Overflow in libc function | KayTii</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/avt/avt.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">KayTii</a><p class="site-subtitle fst-italic mb-0">Pwnable</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/Kaytii210" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['dkhoitran2106','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/khoi-tran206" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://www.facebook.com/kaytii.2210" aria-label="facebook" target="_blank" rel="noopener noreferrer" > <i class="fab fa-facebook"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>[Blog] Stack Pivot - Overflow in libc function</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>[Blog] Stack Pivot - Overflow in libc function</h1><p class="post-desc fw-light mb-4">Stack pivot technique</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1765238400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 9, 2025 </time> </span> <span> Updated <time data-ts="1765295550" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 9, 2025 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/Kaytii210">Khoi Tran</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1283 words" > <em>7 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">[Blog] Stack Pivot - Overflow in libc function</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">[Blog] Stack Pivot - Overflow in libc function</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="preface"><span class="me-2">Preface</span><a href="#preface" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Hello, this is my first blog about a pwnable technique. In this blog, I will explain the attack vector in stack pivot that I usually use in pwnable challenges specifically in this <a href="https://blog.kaytii.me/posts/mimic-writeup/#finals-leak4">challenge</a>.</p><h2 id="background---stack-pivot"><span class="me-2">Background - Stack Pivot</span><a href="#background---stack-pivot" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When calling a function, compiler will create a stack frame for it. A frame typically contains:</p><ul><li>Local variables<li>Saved registers<li>Return address</ul><p>On x86-64, two registers are especially important for stack-related exploitation:</p><ul><li><code class="language-plaintext highlighter-rouge">rsp</code> (Stack Pointer)<ul><li>Always points to the top of the stack.<li>All <code class="language-plaintext highlighter-rouge">push/pop/call/ret</code> operations use <code class="language-plaintext highlighter-rouge">rsp</code>.<pre><code class="language-asm">  push rax  ; rsp -= 8
            ; [rsp] = rax
  pop rax   ; rax = [rsp]
            ; rsp += 8
  call func ; rsp -= 8
            ; [rsp] = rip
  ret       ; rip = [rsp]
            ; rsp += 8
</code></pre></ul><li><code class="language-plaintext highlighter-rouge">rbp</code> (Base Pointer)<ul><li>Points to the base of the current stack frame.<li>Local variables are accessed with negative offsets like <code class="language-plaintext highlighter-rouge">[rbp - offset]</code></ul></ul><p>Function prologue:</p><pre><code class="language-asm">push rbp        ; rsp -= 8
                ; [rsp] = rbp
mov rbp, rsp    ; rbp = rsp
sub rsp, offset ; allocate local variables
</code></pre><p>Function epilogue:</p><pre><code class="language-asm">leave   ; mov rsp, rbp
        ; pop rbp
ret     ; rip = [rsp]
        ; rsp += 8
</code></pre><p>Stack frame layout:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>[ high addresses ]
... previous frames ...
+------------------------+
| return address         |  &lt;-- [rbp+8]
+------------------------+
| saved RBP (caller)     |  &lt;-- [rbp]
+------------------------+
| local variables        |  &lt;-- [rbp-0x8], [rbp-0x10], ...
| (buffers, ints, ...)   |
+------------------------+
[ low addresses ]           &lt;-- rsp after sub
</pre></table></code></div></div><p>So what is stack pivot? A stack pivot is a technique that allows us to change the stack pointer (<code class="language-plaintext highlighter-rouge">rsp</code>) to a memory region we control (for example, a buffer on the heap, .bss, or another stack area). This is useful when we donâ€™t enough gadgets or libc leaks to perform a ROP chain on the original stack.</p><p>Some common ways to achieve stack pivot:</p><ul><li>Overwriting saved <code class="language-plaintext highlighter-rouge">rbp</code> and then after the second <code class="language-plaintext highlighter-rouge">leave; ret</code>, <code class="language-plaintext highlighter-rouge">rsp</code> will be set to our controlled memory.<li>Using some gadgets such as <code class="language-plaintext highlighter-rouge">pop rbp; ret</code> or <code class="language-plaintext highlighter-rouge">leave; ret</code> to set <code class="language-plaintext highlighter-rouge">rbp</code> and <code class="language-plaintext highlighter-rouge">rsp</code>.</ul><h2 id="overflow-in-libc-function"><span class="me-2">Overflow in libc function</span><a href="#overflow-in-libc-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>As I mentioned above, every C function compiled with the System V ABI gets a prologue and an epilogue that set up and tear down its stack frame. From the CPUâ€™s point of view, calling <code class="language-plaintext highlighter-rouge">scanf</code> is no different from calling a user-defined <code class="language-plaintext highlighter-rouge">foo()</code> â€” itâ€™s still a <code class="language-plaintext highlighter-rouge">call</code> instruction that creates a new stack frame, and that function is free to call other functions inside libc.</p><p>Another detail that is easy to overlook is that many libc functions are actually thin wrappers around more complex internal helpers. For example, when you call:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</pre></table></code></div></div><p>the control flow usually looks like:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>main
  â””â”€ __isoc99_scanf           // public wrapper
       â””â”€ __vfscanf_internal  // real parser/worker
            â””â”€ (other internal helpers, locale helpers, â€¦)
</pre></table></code></div></div><p>Every each of these functions has its own prologue, epilogue and thus its own stack frame: local variables at <code class="language-plaintext highlighter-rouge">[rbp - offset]</code>, a saved frame pointer at <code class="language-plaintext highlighter-rouge">[rbp]</code>, and a return address at <code class="language-plaintext highlighter-rouge">[rbp + 8]</code>.</p><p>So what happens if we can make an overflow inside one of these internal libc functions, specifically in libc input function such as <code class="language-plaintext highlighter-rouge">scanf</code>, <code class="language-plaintext highlighter-rouge">read</code>, <code class="language-plaintext highlighter-rouge">fgets</code>? The attack vector relies on <strong>Frame Overlap</strong>.</p><p>We know that in a standard function (like <code class="language-plaintext highlighter-rouge">main</code>), a local buffer is located at a fixed offset from the Base Pointer:</p><pre><code class="language-asm">lea rax, [rbp - 0x100]  ; load address of buffer
mov rsi, rax            ; argument for read/scanf
</code></pre><p>If we can overwrite the <strong>saved RBP</strong> of the current function and return, the caller (e.g., main) will think its stack frame is somewhere else.</p><h3 id="set-up"><span class="me-2">Set up</span><a href="#set-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We use a small primitive to overwrite the Saved RBP on the stack to a location called <code class="language-plaintext highlighter-rouge">fake_rbp</code> and when the function returns, it executes <code class="language-plaintext highlighter-rouge">leave; ret</code>:</p><ul><li><code class="language-plaintext highlighter-rouge">mov rsp, rbp</code> cleaning up the stack.<li><code class="language-plaintext highlighter-rouge">pop rbp</code> pop our <code class="language-plaintext highlighter-rouge">fake_rbp</code> into <code class="language-plaintext highlighter-rouge">rbp</code>.<li><code class="language-plaintext highlighter-rouge">ret</code> execution returns to the caller (e.g., <code class="language-plaintext highlighter-rouge">main</code>).</ul><p>Now, weâ€™re back in <code class="language-plaintext highlighter-rouge">main</code>, but the <code class="language-plaintext highlighter-rouge">rbp</code> is pointing to our <code class="language-plaintext highlighter-rouge">fake_rbp</code> location.</p><h3 id="trigger"><span class="me-2">Trigger</span><a href="#trigger" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">main</code> then continues execute and calls an input function like <code class="language-plaintext highlighter-rouge">read(0, buf, 0x100)</code> to read data. To prepare for this call, <code class="language-plaintext highlighter-rouge">main</code> calculates the address of the <code class="language-plaintext highlighter-rouge">buf</code> related to the current <code class="language-plaintext highlighter-rouge">rbp</code>:</p><pre><code class="language-asm">lea rax, [rbp - 0x100] ; buffer = fake_rbp - 0x100
</code></pre><p>At this point, if we carefully choose <code class="language-plaintext highlighter-rouge">fake_rbp</code> such that <code class="language-plaintext highlighter-rouge">buf</code> overlaps with the saved <code class="language-plaintext highlighter-rouge">rbp</code> and return address of the input function (<code class="language-plaintext highlighter-rouge">read</code>), we can exploit this overlap to overflow into those critical fields.</p><h3 id="example"><span class="me-2">Example</span><a href="#example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Letâ€™s take an example with <code class="language-plaintext highlighter-rouge">read(0, buf, 0x100)</code>: Suppose we are in a function <code class="language-plaintext highlighter-rouge">vuln()</code> with a primitive to overflow to return address:</p><ul><li>Original <code class="language-plaintext highlighter-rouge">rbp</code> : <code class="language-plaintext highlighter-rouge">0x7fffffffe100</code><li>Fake <code class="language-plaintext highlighter-rouge">rbp</code> : <code class="language-plaintext highlighter-rouge">0x7fffffffe200</code></ul><p>When <code class="language-plaintext highlighter-rouge">vuln()</code> executes <code class="language-plaintext highlighter-rouge">leave; ret</code> and return to <code class="language-plaintext highlighter-rouge">lea rax, [rbp - 0x100]</code>:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>leave       ; mov rsp, rbp  ; rsp = 0x7fffffffe100
            ; pop rbp       ; rsp = 0x7fffffffe108, rbp = 0x7fffffffe200
ret         ; rip = [rsp]   ; return address
            ; rsp += 8      ; rsp = 0x7fffffffe110

lea rax, [rbp - 0x100] ; buf = 0x7fffffffe200 - 0x100 = 0x7fffffffe100
</pre></table></code></div></div><p>Next <code class="language-plaintext highlighter-rouge">vuln()</code> executes read again:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>call read   ; rsp -=8        ; rsp = 0x7fffffffe108
            ; [rsp] = rip
</pre></table></code></div></div><p>The return address will be at <code class="language-plaintext highlighter-rouge">0x7fffffffe108</code>. As you can see, the buffer now is <code class="language-plaintext highlighter-rouge">0x7fffffffe100</code> which is just above the return address 8 bytes. Inside of <code class="language-plaintext highlighter-rouge">read</code>, it will have a <code class="language-plaintext highlighter-rouge">syscall</code> read to <strong>actually read our input</strong> and we can easily get an overflow to overwrite the save rbp and return address of <code class="language-plaintext highlighter-rouge">read</code>.</p><blockquote class="prompt-warning"><p>Keep in mind: some libc functions have their own stack canaries!!!</p></blockquote><h2 id="application"><span class="me-2">Application</span><a href="#application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In the <a href="https://blog.kaytii.me/posts/mimic-writeup/#finals-leak4">challenge</a>, I only have a very weak primitive: I can arbitrarily overwrite <strong>2 bytes</strong> at a chosen address. The execution then goes into an encode function that I canâ€™t really control, so at first glance it looks like thereâ€™s no way to build an ORW ROP chain.</p><p>The key idea is to stop targeting the return address and instead focus on the <strong>saved <code class="language-plaintext highlighter-rouge">rbp</code></strong>. By carefully computing offsets, I find a pointer that lets me turn a later <code class="language-plaintext highlighter-rouge">read</code> into a stack overflow. Once I overwrite <code class="language-plaintext highlighter-rouge">rbp</code>, the next <code class="language-plaintext highlighter-rouge">read</code> call will use this region as part of its stack frame. That finally gives me RIP control and lets me jump to my ROP chain, even though I only started with a 2-byte write primitive.</p><p>This leads to an <strong>unintended solution</strong> for the challenge, but more importantly it shows a useful pattern: you donâ€™t always need to touch the original return address. You can first <strong>misalign the stack via <code class="language-plaintext highlighter-rouge">rbp</code> or <code class="language-plaintext highlighter-rouge">rsp</code></strong>, then abuse a later function (like <code class="language-plaintext highlighter-rouge">read</code>, <code class="language-plaintext highlighter-rouge">scanf</code>) to do the actual overwrite.</p><p>In addition, internal libc helpers themselves are packed with handy gadgets, such as sequences that pop registers and then return. When the binary has very few useful instructions, these internal functions effectively act as an extra gadget pool, giving you the missing pieces you need to build a working payload even in a very constrained environment.</p><p>In <code class="language-plaintext highlighter-rouge">__vfscanf_internal</code>:</p><p><a href="/assets/img/stack_pivot_blog/pic1.png" class="popup img-link normal shimmer"><img src="/assets/img/stack_pivot_blog/pic1.png" alt="Desktop View" width="500" height="500" loading="lazy"></a></p><p><code class="language-plaintext highlighter-rouge">fgets</code>:</p><p><a href="/assets/img/stack_pivot_blog/pic2.png" class="popup img-link normal shimmer"><img src="/assets/img/stack_pivot_blog/pic2.png" alt="Desktop View" width="500" height="500" loading="lazy"></a></p><p><code class="language-plaintext highlighter-rouge">getchar</code>:</p><p><a href="/assets/img/stack_pivot_blog/pic3.png" class="popup img-link normal shimmer"><img src="/assets/img/stack_pivot_blog/pic3.png" alt="Desktop View" width="500" height="500" loading="lazy"></a></p><p>Furthermore, this technique is not tied to this specific setup. In general, itâ€™s often enough to tamper with the <strong>saved return address</strong> of a function or, more subtly, just the <strong>saved <code class="language-plaintext highlighter-rouge">rbp</code></strong>. If you can redirect <code class="language-plaintext highlighter-rouge">rbp</code> into attacker-controlled memory, the normal epilogue (<code class="language-plaintext highlighter-rouge">leave; ret</code>) will pivot the stack for you. From there, any function that reads or writes a large chunk of data on that fake frame becomes a powerful primitive to overwrite the new return address. Simply controlling <code class="language-plaintext highlighter-rouge">rbp</code>/<code class="language-plaintext highlighter-rouge">rsp</code> can be enough to reach full ROP in cases where a direct overwrite of the original return address seems impossible.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/pwnable/">Pwnable</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/blog/" class="post-tag no-text-decoration" >blog</a> <a href="/tags/stack-pivot/" class="post-tag no-text-decoration" >stack pivot</a> <a href="/tags/technique/" class="post-tag no-text-decoration" >technique</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Blog]%20Stack%20Pivot%20-%20Overflow%20in%20libc%20function%20-%20KayTii&url=https%3A%2F%2Fblog.kaytii.me%2Fposts%2Fstack-pivot-technique%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Blog]%20Stack%20Pivot%20-%20Overflow%20in%20libc%20function%20-%20KayTii&u=https%3A%2F%2Fblog.kaytii.me%2Fposts%2Fstack-pivot-technique%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.kaytii.me%2Fposts%2Fstack-pivot-technique%2F&text=[Blog]%20Stack%20Pivot%20-%20Overflow%20in%20libc%20function%20-%20KayTii" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/pwncollege-advent-writeup/">[Writeup] Advent of Pwn 2025(Pwn College)</a><li class="text-truncate lh-lg"> <a href="/posts/stack-pivot-technique/">[Blog] Stack Pivot - Overflow in libc function</a><li class="text-truncate lh-lg"> <a href="/posts/mimic-writeup/">[Writeup] 2025 Qiangwang Challenge on Cyber Mimic Defense</a><li class="text-truncate lh-lg"> <a href="/posts/pwn-study-notes/">ðŸ““ PWN STUDY NOTES</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/stack-pivot/">stack pivot</a> <a class="post-tag btn btn-outline-primary" href="/tags/writeup/">writeup</a> <a class="post-tag btn btn-outline-primary" href="/tags/angr/">angr</a> <a class="post-tag btn btn-outline-primary" href="/tags/blockchain/">blockchain</a> <a class="post-tag btn btn-outline-primary" href="/tags/blog/">blog</a> <a class="post-tag btn btn-outline-primary" href="/tags/ebpf/">eBPF</a> <a class="post-tag btn btn-outline-primary" href="/tags/io-uring/">io_uring</a> <a class="post-tag btn btn-outline-primary" href="/tags/ms-dos/">MS-DOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/pypu-pci/">pypu-pci</a> <a class="post-tag btn btn-outline-primary" href="/tags/rop/">rop</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/mimic-writeup/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1764547200" data-df="ll" > Dec 1, 2025 </time><h4 class="pt-0 my-2">[Writeup] 2025 Qiangwang Challenge on Cyber Mimic Defense</h4><div class="text-muted"><p>Writeup for Mimic CTF 2025</p></div></div></a></article><article class="col"> <a href="/posts/pwncollege-advent-writeup/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1766188800" data-df="ll" > Dec 20, 2025 </time><h4 class="pt-0 my-2">[Writeup] Advent of Pwn 2025(Pwn College)</h4><div class="text-muted"><p>Writeup for Advent of Pwn 2025</p></div></div></a></article><article class="col"> <a href="/posts/pwn-study-notes/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1742688000" data-df="ll" > Mar 23, 2025 </time><h4 class="pt-0 my-2">ðŸ““ PWN STUDY NOTES</h4><div class="text-muted"><p>PWN 101</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/mimic-writeup/" class="btn btn-outline-primary" aria-label="Older" ><p>[Writeup] 2025 Qiangwang Challenge on Cyber Mimic Defense</p></a> <a href="/posts/pwncollege-advent-writeup/" class="btn btn-outline-primary" aria-label="Newer" ><p>[Writeup] Advent of Pwn 2025(Pwn College)</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>Â© <time>2025</time> <a href="https://github.com/Kaytii210">Khoi Tran</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/stack-pivot/">stack pivot</a> <a class="post-tag btn btn-outline-primary" href="/tags/writeup/">writeup</a> <a class="post-tag btn btn-outline-primary" href="/tags/angr/">angr</a> <a class="post-tag btn btn-outline-primary" href="/tags/blockchain/">blockchain</a> <a class="post-tag btn btn-outline-primary" href="/tags/blog/">blog</a> <a class="post-tag btn btn-outline-primary" href="/tags/ebpf/">eBPF</a> <a class="post-tag btn btn-outline-primary" href="/tags/io-uring/">io_uring</a> <a class="post-tag btn btn-outline-primary" href="/tags/ms-dos/">MS-DOS</a> <a class="post-tag btn btn-outline-primary" href="/tags/pypu-pci/">pypu-pci</a> <a class="post-tag btn btn-outline-primary" href="/tags/rop/">rop</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside><script> (function () { var btn = document.getElementById('back-to-top'); if (!btn) return; btn.addEventListener('click', function () { btn.classList.remove('slime-click'); void btn.offsetWidth; btn.classList.add('slime-click'); }); btn.addEventListener('animationend', function (e) { if (e.animationName === 'slime-click') { btn.classList.remove('slime-click'); } }); })(); </script></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
